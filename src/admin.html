<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - SPARK Prompt Library</title>

  <!-- IMMEDIATE AUTH CHECK - Blocks page load if not authenticated -->
  <script>
    (function() {
      const token = sessionStorage.getItem('adminToken');
      const isAuth = sessionStorage.getItem('adminAuth') === 'true';

      if (!token || !isAuth) {
        window.location.replace('admin-login.html');
      }
    })();
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .table-container { max-height: 600px; overflow-y: auto; }
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
    .modal.active { display: flex; align-items: center; justify-content: center; }
    .modal-content { background: white; padding: 32px; border-radius: 8px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; }
  </style>
</head>
<body class="bg-gray-100">

<!-- Header -->
<header class="bg-gray-800 text-white p-4">
  <div class="container mx-auto flex justify-between items-center">
    <h1 class="text-2xl font-bold">üîß Admin Dashboard</h1>
    <div class="flex gap-4">
      <button id="backupBtn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded flex items-center gap-2">
        üíæ Backup Now
      </button>
      <button id="validationBtn" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded flex items-center gap-2">
        ‚úÖ Data Quality
      </button>
      <a href="browse.html" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">View Library</a>
      <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">Logout</button>
    </div>
  </div>
</header>

<!-- Main Container -->
<div class="container mx-auto p-6">

  <!-- Statistics Dashboard -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-bold mb-4">üìä Statistics</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div class="bg-blue-50 p-4 rounded">
        <div class="text-3xl font-bold text-blue-600" id="statTotal">0</div>
        <div class="text-sm text-gray-600">Total Prompts</div>
      </div>
      <div class="bg-green-50 p-4 rounded">
        <div class="text-3xl font-bold text-green-600" id="statBusiness">0</div>
        <div class="text-sm text-gray-600">Business</div>
      </div>
      <div class="bg-purple-50 p-4 rounded">
        <div class="text-3xl font-bold text-purple-600" id="statMarketing">0</div>
        <div class="text-sm text-gray-600">Marketing</div>
      </div>
      <div class="bg-orange-50 p-4 rounded">
        <div class="text-3xl font-bold text-orange-600" id="statSelected">0</div>
        <div class="text-sm text-gray-600">Selected</div>
      </div>
    </div>
  </div>

  <!-- Search & Filter Controls -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-bold mb-4">üîç Search & Filter</h2>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
      <input
        type="text"
        id="searchInput"
        placeholder="Search by title, description, tags..."
        class="border rounded px-4 py-2 w-full"
      >

      <select id="departmentFilter" class="border rounded px-4 py-2 w-full">
        <option value="">All Departments</option>
        <option value="Business">Business</option>
        <option value="Marketing">Marketing</option>
        <option value="Sales">Sales</option>
        <option value="SEO">SEO</option>
        <option value="Finance">Finance</option>
        <option value="Education">Education</option>
        <option value="Writing">Writing</option>
        <option value="Productivity">Productivity</option>
        <option value="Solopreneurs">Solopreneurs</option>
      </select>

      <select id="sortBy" class="border rounded px-4 py-2 w-full">
        <option value="date-desc">Date (Newest First)</option>
        <option value="date-asc">Date (Oldest First)</option>
        <option value="title-asc">Title (A-Z)</option>
        <option value="title-desc">Title (Z-A)</option>
        <option value="dept-asc">Department (A-Z)</option>
      </select>

      <button id="clearFilters" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
        Clear Filters
      </button>
    </div>

    <!-- Bulk Actions -->
    <div class="flex gap-4">
      <button id="selectAllBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
        Select All
      </button>
      <button id="deselectAllBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
        Deselect All
      </button>
      <button id="bulkDeleteBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">
        Delete Selected
      </button>
      <button id="exportSelectedBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
        Export Selected
      </button>
      <button id="exportAllBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
        Export All
      </button>
    </div>
  </div>

  <!-- Prompts Table -->
  <div class="bg-white rounded-lg shadow-md">
    <div class="p-6">
      <h2 class="text-xl font-bold mb-4">üìã All Prompts</h2>

      <!-- Results Info -->
      <div class="mb-4 text-sm text-gray-600">
        Showing <span id="showingCount">0</span> of <span id="totalCount">0</span> prompts
        (Page <span id="currentPage">1</span> of <span id="totalPages">1</span>)
      </div>

      <!-- Table -->
      <div class="table-container border rounded">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50 sticky top-0">
            <tr>
              <th class="px-4 py-3 text-left">
                <input type="checkbox" id="selectAllCheckbox" class="rounded">
              </th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Department</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Subcategory</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tags</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Words</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
            </tr>
          </thead>
          <tbody id="promptsTableBody" class="bg-white divide-y divide-gray-200">
            <!-- Rows will be inserted here -->
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="mt-4 flex justify-between items-center">
        <div>
          <label class="text-sm text-gray-600">
            Rows per page:
            <select id="rowsPerPage" class="border rounded px-2 py-1 ml-2">
              <option value="25">25</option>
              <option value="50" selected>50</option>
              <option value="100">100</option>
              <option value="250">250</option>
            </select>
          </label>
        </div>
        <div class="flex gap-2">
          <button id="prevPage" class="bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded disabled:opacity-50">
            Previous
          </button>
          <button id="nextPage" class="bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded disabled:opacity-50">
            Next
          </button>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h2 class="text-2xl font-bold mb-4">‚úèÔ∏è Edit Prompt</h2>
    <form id="editForm">
      <input type="hidden" id="editPromptId">

      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">Title *</label>
        <input type="text" id="editTitle" required class="border rounded px-4 py-2 w-full">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">Department *</label>
        <select id="editDepartment" required class="border rounded px-4 py-2 w-full">
          <option value="Business">Business</option>
          <option value="Marketing">Marketing</option>
          <option value="Sales">Sales</option>
          <option value="SEO">SEO</option>
          <option value="Finance">Finance</option>
          <option value="Education">Education</option>
          <option value="Writing">Writing</option>
          <option value="Productivity">Productivity</option>
          <option value="Solopreneurs">Solopreneurs</option>
        </select>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">Subcategory</label>
        <input type="text" id="editSubcategory" class="border rounded px-4 py-2 w-full">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">Description *</label>
        <textarea id="editDescription" required rows="3" class="border rounded px-4 py-2 w-full"></textarea>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">Prompt Content *</label>
        <textarea id="editContent" required rows="10" class="border rounded px-4 py-2 w-full font-mono text-sm"></textarea>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">Tags (comma separated)</label>
        <input type="text" id="editTags" placeholder="tag1, tag2, tag3" class="border rounded px-4 py-2 w-full">
      </div>

      <div class="flex gap-4 mt-6">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">
          Save Changes
        </button>
        <button type="button" id="cancelEdit" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content max-w-md">
    <h2 class="text-2xl font-bold mb-4 text-red-600">‚ö†Ô∏è Confirm Delete</h2>
    <p class="mb-4">Are you sure you want to delete this prompt?</p>
    <p class="mb-6 font-semibold" id="deletePromptTitle"></p>
    <p class="mb-6 text-sm text-red-600">This action cannot be undone.</p>
    <div class="flex gap-4">
      <button id="confirmDelete" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded">
        Delete
      </button>
      <button id="cancelDelete" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- Validation Modal -->
<div id="validationModal" class="modal">
  <div class="modal-content max-w-4xl">
    <h2 class="text-2xl font-bold mb-4 text-yellow-600">‚úÖ Data Quality Check</h2>

    <div id="validationSummary" class="mb-6 p-4 bg-gray-50 rounded"></div>

    <div class="space-y-4">
      <!-- Duplicate Titles -->
      <div class="border rounded p-4">
        <h3 class="font-bold mb-2 text-red-600">üî¥ Duplicate Titles (<span id="dupCount">0</span>)</h3>
        <div id="duplicatesList" class="text-sm max-h-40 overflow-y-auto"></div>
      </div>

      <!-- Missing Descriptions -->
      <div class="border rounded p-4">
        <h3 class="font-bold mb-2 text-orange-600">üü† Missing Descriptions (<span id="descCount">0</span>)</h3>
        <div id="missingDescList" class="text-sm max-h-40 overflow-y-auto"></div>
      </div>

      <!-- Missing Tags -->
      <div class="border rounded p-4">
        <h3 class="font-bold mb-2 text-yellow-600">üü° Missing Tags (<span id="tagsCount">0</span>)</h3>
        <div id="missingTagsList" class="text-sm max-h-40 overflow-y-auto"></div>
      </div>

      <!-- Malformed Entries -->
      <div class="border rounded p-4">
        <h3 class="font-bold mb-2 text-red-600">üî¥ Malformed Entries (<span id="malCount">0</span>)</h3>
        <div id="malformedList" class="text-sm max-h-40 overflow-y-auto"></div>
      </div>
    </div>

    <div class="flex gap-4 mt-6">
      <button id="exportValidationReport" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">
        Export Report
      </button>
      <button id="closeValidation" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Loading Indicator -->
<div id="loading" class="fixed bottom-4 right-4 bg-blue-600 text-white px-6 py-3 rounded shadow-lg hidden">
  Loading...
</div>

<!-- Success/Error Toast -->
<div id="toast" class="fixed top-4 right-4 px-6 py-3 rounded shadow-lg hidden"></div>

<script type="module" src="js/admin.js"></script>
</body>
</html>
